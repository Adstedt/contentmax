# Story 01.04: Product and Brand Search Functionality

## Status

Draft

## Story

**As a** content manager working with product catalogs,
**I want** to search for products by name or brand across the taxonomy,
**so that** I can quickly find specific products without navigating through category hierarchies.

## Acceptance Criteria

### Functional Requirements:

1. **Smart Contextual Search**
   - Single search input that adapts based on current view
   - Search scope toggle: Categories | Products
   - Auto-switch to product search when viewing product list
   - Manual toggle available at top-level category view

2. **Search Scope: Categories (Current Behavior)**
   - Filter visible categories by title (existing functionality)
   - Real-time filtering as user types
   - Maintains current status filters and sorting

3. **Search Scope: Products (New)**
   - Search products by:
     - Product title (case-insensitive, partial match)
     - Brand name (case-insensitive, partial match)
   - Two modes:
     - **In Product View:** Filter current category's products
     - **In Category View:** Global search across all products in taxonomy

4. **Search UI/UX**
   - Placeholder updates based on scope:
     - "Search categories..." when scope = categories
     - "Search products..." when scope = products
   - Scope toggle dropdown next to search input
   - Clear search button (X) when query is not empty
   - Search persists when navigating between categories (optional)

5. **Global Product Search Results**
   - When searching products from category view:
     - Show dedicated product results view
     - Display matching products with category breadcrumb context
     - "Found in: Category > Subcategory" metadata per product
     - Click product to open in ProductDetailModal
     - Click category path to navigate to that category

### Integration Requirements:

6. **State Management**

   ```typescript
   const [searchQuery, setSearchQuery] = useState('');
   const [searchScope, setSearchScope] = useState<'categories' | 'products'>('categories');
   ```

7. **Auto-Scope Switching**
   - When `products.length > 0` (viewing product list): auto-switch to 'products'
   - When navigating back to categories: auto-switch to 'categories'
   - User can manually override at any time

8. **Product Filter Integration**
   - Add search filter to existing product filtering logic (around line 1424)
   - Apply BEFORE price/brand/availability filters
   - Works with existing sort functionality

9. **API Considerations**
   - Global product search may require new API endpoint
   - Option 1: Fetch all products and filter client-side
   - Option 2: Server-side search endpoint with query parameter
   - Consider pagination for large result sets

### Design System Consistency:

10. **Visual Design**
    - Scope toggle uses existing dropdown styling
    - Search input matches existing category search styling
    - Clear button uses gray-400 hover:gray-100 colors
    - Results view maintains existing card styling

11. **Jira-Style Product Cards**
    - Search results use existing SimpleProductCard component
    - Labels, status, and metadata visible in results
    - Maintains Jira-inspired information density

## Alternative Approach: Combined Results View

**Option 4** (for future consideration):

- Show BOTH categories and products in results simultaneously
- Two sections: "Categories (3)" and "Products (47)"
- Similar to Google's categorized search results
- More complex but most powerful UX

## Technical Notes

### Current Search Implementation:

- **Line 53:** `searchQuery` state (categories only)
- **Line 241-248:** Category filtering logic
- **Line 647-654:** Search input component
- **Line 1424-1446:** Product filters (no search support currently)

### Files to Modify:

- `components/taxonomy/TaxonomyVisualization.tsx` - Main search logic
- Potential new component: `GlobalProductSearchResults.tsx`

### Dependencies:

- No new npm packages required
- Uses existing Product interface
- Leverages existing filter/sort patterns

## Dev Notes

- Consider clearing search when navigating if UX feels jarring
- Global search may need loading state for API fetch
- Product results should respect existing filters (price, brand, availability)
- Ensure search performance with large product catalogs

## Testing

### Unit Tests:

- [ ] Search filters products by title (case-insensitive)
- [ ] Search filters products by brand (case-insensitive)
- [ ] Search combines with existing filters correctly
- [ ] Scope toggle updates placeholder text
- [ ] Auto-scope switching works when products load

### Integration Tests:

- [ ] Category search continues to work (no regression)
- [ ] Product search in category view shows correct results
- [ ] Global product search returns cross-category results
- [ ] Clear search button resets results

### Manual Tests:

- [ ] Search products by partial brand name (e.g., "Nik" finds "Nike")
- [ ] Search products by partial title
- [ ] Toggle between scopes maintains query
- [ ] Global search shows category context for products
- [ ] Performance acceptable with 1000+ products

## Tasks

### Phase 1: Product Search in Current Category

- [ ] Add `searchScope` state variable
- [ ] Add scope toggle dropdown component
- [ ] Update search placeholder dynamically
- [ ] Add product search filter logic (title + brand)
- [ ] Test with existing product view

### Phase 2: Global Product Search

- [ ] Design global search results view
- [ ] Implement API endpoint or client-side aggregation
- [ ] Add category context to results
- [ ] Add navigation from results to categories
- [ ] Handle empty states and loading

### Phase 3: Polish

- [ ] Add clear search button
- [ ] Optimize search performance
- [ ] Add keyboard shortcuts (Cmd+K / Ctrl+K)
- [ ] Update user documentation

## Completion Notes

(To be filled by dev agent upon completion)

## Change Log

- 2025-09-30: Story created (Draft)
